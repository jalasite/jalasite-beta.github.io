I"VC<h2 id="samba-">Samba ?</h2>

<p>Samba adalah sebuah protokol Server Message Block (SMB). Awalnya dikembangkan oleh Microsoft untuk menghubungkan komputer windows bersama-sama melalui jaringan area lokal, sekarang banyak digunakan untuk komunikasi jaringan internal.</p>

<p>Apple juga mempunyai protokol sharing file sendiri yang disebut “Apple Filing Protocol (AFP)”, namun belakangan ini, juga telah beralih ke SMB.</p>

<p>Dalam panduan ini kita akan mencoba configurasi sederhana untuk mengaktifkan:</p>
<ul>
  <li>Public Folder Sharing (Read Only and Read Write)</li>
  <li>User Home Folder Access</li>
</ul>

<p>Catatan:</p>

<p>”$  untuk prompt perintah pengguna lokal”<br />
“# untuk prompt pengguna super”</p>

<h2 id="public-sharing-folder">Public Sharing Folder</h2>

<h3 id="create-folder">Create Folder</h3>

<p>Untuk panduan ini  kita akan menggunakan folder “/srv/public/”.</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># mkdir --verbose /srv/public
</code></pre></div>  </div>
</blockquote>

<h3 id="set-filesystem-security-context">Set Filesystem Security Context</h3>

<p>Untuk dapat melakukan proses baca dan tulis ke folder publik, kita akan membuat context security “public_content_rw_t”. Mereka yang hanya ingin membaca saja dapat menggunakan: “public_content_t”.</p>

<p>Tambahkan security filesystem security context:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># semanage fcontext --add --type public_content_rw_t "/srv/public(/.*)?"
</code></pre></div>  </div>
</blockquote>

<p>Lihat security filesystem security context yang telah dibuat:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># semanage fcontext --locallist --list
</code></pre></div>  </div>
</blockquote>

<p>Akan terlihat seperti dibawah ini</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/srv/public(/.*)? all files system_u:object_r:public_content_rw_t:s0
</code></pre></div>  </div>
</blockquote>

<p>Sekarang folder telah ditambahkan ke security context registry sistem file lokal. Perintah restorecon dapat digunakan untuk ‘mengembalikan’ context ke folder:</p>

<p>Restore security context ke the /srv/public folder:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># restorecon -Rv /srv/public
</code></pre></div>  </div>
</blockquote>

<p>Lihat security context yang telah dibuat:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls --directory --context /srv/public/
</code></pre></div>  </div>
</blockquote>

<p>Akan terlihat seperti dibawah ini</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unconfined_u:object_r:public_content_rw_t:s0 /srv/public/
</code></pre></div>  </div>
</blockquote>

<h3 id="user-permissions">User Permissions</h3>

<h3 id="creating-the-sharing-groups">Creating the Sharing Groups</h3>

<p>Untuk mengizinkan pengguna memiliki hak akses baca saja, atau baca dan tulis ke sharing folder, buatlah dua grup baru yang mengatur akses nya: “public_readonly dan public_readwrite”.</p>

<p>User account dapat diberikan akses untuk sekedar membaca saja, atau membaca dan menulis dengan menambahkan akun mereka ke grup masing-masing.</p>

<p>Membuat group public_readonly and public_readwrite:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># groupadd public_readonly
# groupadd public_readwrite
</code></pre></div>  </div>
</blockquote>

<p>Melihat group yang kita telah buat:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ getent group public_readonly public_readwrite
</code></pre></div>  </div>
</blockquote>

<p>Akan terlihat hasil nya sbb:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public_readonly:x:1009:
public_readwrite:x:1010:
</code></pre></div>  </div>
</blockquote>

<h3 id="set-permissions">Set permissions</h3>

<p>Sekarang kita akan mengatur izin akses user di public share folder yang kita telah buat.</p>

<p>Set User and Group Permissions for Folder:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># chmod --verbose 2700 /srv/public
# setfacl -m group:public_readonly:r-x /srv/public
# setfacl -m default:group:public_readonly:r-x /srv/public
# setfacl -m group:public_readwrite:rwx /srv/public
# setfacl -m default:group:public_readwrite:rwx /srv/public
</code></pre></div>  </div>
</blockquote>

<p>Melihat user permission yang telah dibuat:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ getfacl --absolute-names /srv/public
</code></pre></div>  </div>
</blockquote>

<p>Akan terihat hasilnya:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file: /srv/public
owner: root
group: root
flags: -s-
user::rwx
group::---
group:public_readonly:r-x
group:public_readwrite:rwx
mask::rwx
other::---
default:user::rwx
default:group::---
default:group:public_readonly:r-x
default:group:public_readwrite:rwx
default:mask::rwx
default:other::---
</code></pre></div>  </div>
</blockquote>

<h2 id="samba">Samba</h2>

<h3 id="installation">Installation</h3>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># dnf install samba
</code></pre></div>  </div>
</blockquote>

<h3 id="hostname-systemwide">Hostname (systemwide)</h3>

<p>Samba akan menggunakan nama komputer saat berbagi file, ada baiknya untuk mengatur nama host agar komputer dapat ditemukan dengan mudah di jaringan lokal.</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Melihat hostname kita saat ini
</code></pre></div>  </div>
</blockquote>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ hostnamectl status
</code></pre></div>  </div>
</blockquote>

<p>Jika kita hendak merubah nama dari  hostname kita, berikut ini perintahnya:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># hostnamectl set-hostname "simple-samba-server"
</code></pre></div>  </div>
</blockquote>

<h3 id="firewall">Firewall</h3>

<p>Mengkonfigurasi firewall tidak lah mudah, berikut ini cara sederhana yang mungkin bisa dilakukan.</p>

<p>Mengizinkan akses samba melalui firewall:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># firewall-cmd --add-service=samba --permanent
# firewall-cmd --reload
</code></pre></div>  </div>
</blockquote>

<p>Melihat apakah service samba sudah aktif di firewall kita:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ firewall-cmd --list-services
</code></pre></div>  </div>
</blockquote>

<p>Dan outputnya adalah:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>samba
</code></pre></div>  </div>
</blockquote>

<h3 id="configuration">Configuration</h3>

<h4 id="menghapus-default-configuration">Menghapus Default Configuration</h4>

<p>Untuk configurasi sederhana ini kita tidak memerlukan default configurasi fedora system, maka kita akan coba membackup nya dan membuat configurasi baru</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp --verbose --no-clobber /etc/samba/smb.conf /etc/samba/smb.conf.fedora0
</code></pre></div>  </div>
</blockquote>

<p>Mengkosongkan configuration file:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># &gt; /etc/samba/smb.conf
</code></pre></div>  </div>
</blockquote>

<h4 id="samba-configuration">Samba Configuration</h4>

<p>Mengedit file configurasi samba dengan Vim:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vim /etc/samba/smb.conf
</code></pre></div>  </div>
</blockquote>

<p>Tambahkan baris perintah berikut kedalam file /etc/samba/smb.conf</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># smb.conf - Samba Configuration File
</code></pre></div>  </div>
</blockquote>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># The name of the share is in square brackets [],
# this will be shared as //hostname/sharename
# There are a three exceptions:
#   the [global] section;
#   the [homes] section, that is dynamically set to the username;
#   the [printers] section, same as [homes], but for printers.
</code></pre></div>  </div>
</blockquote>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># path: the physical filesystem path (or device)
# comment: a label on the share, seen on the network.
# read only: disable writing, defaults to true.
</code></pre></div>  </div>
</blockquote>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># For a full list of configuration options,
#   please read the manual: "man smb.conf".
</code></pre></div>  </div>
</blockquote>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[global]
</code></pre></div>  </div>
</blockquote>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[public]
path = /srv/public
comment = Public Folder
read only = No
</code></pre></div>  </div>
</blockquote>

<h3 id="write-permission-ijin-akses-tulis-pada-folder">Write Permission (Ijin akses Tulis pada Folder)</h3>

<p>Secara default, Samba tidak diberikan izin untuk memodifikasi file apa pun dari sistem. Ubah konfigurasi keamanan sistem untuk memungkinkan Samba memodifikasi jalur sistem file apa pun yang memiliki security contex “public_content_rw_t.”</p>

<p>Untuk kenyamanan, Fedora memiliki SELinux Boolean bawaan untuk tujuan ini yang disebut: smbd_anon_write, set nilai ini ke true akan memungkinkan Samba untuk menulis di jalur sistem file apa pun yang telah disetel ke security contex public_content_rw_t.</p>

<p>Bagi mereka yang menginginkan Samba hanya memiliki akses baca-saja di share folder publik mereka, mereka boleh mengabaikan setelan ini.</p>

<p>Set SELinux Boolean agar mengijinkan samba untuk menulis ke filesystem dengan security context public_content_rw_t:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># setsebool -P smbd_anon_write=1
</code></pre></div>  </div>
</blockquote>

<p>Cek nilai yang baru saja kita set:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ getsebool smbd_anon_write
</code></pre></div>  </div>
</blockquote>

<p>seharusnya akan menampilkan hasil:</p>

<p>$ getsebool smbd_anon_write</p>

<h2 id="samba-services">Samba Services</h2>

<p>Samba Services dibagi menjadi dua bagian yang harus kita hidupkan.</p>

<h3 id="samba-smb-service">Samba ‘smb’ Service</h3>

<p>Layanan “Server Message Block” (SMB) Samba adalah untuk berbagi file dan printer melalui jaringan lokal.</p>

<h3 id="enable-and-start-services">Enable and Start Services</h3>

<p>Enable and start smb and nmb services:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># systemctl enable smb.service
# systemctl start smb.service
</code></pre></div>  </div>
</blockquote>

<p>Cek smb service</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># systemctl start smb.service
</code></pre></div>  </div>
</blockquote>

<h3 id="test-public-sharing-localhost">Test Public Sharing (localhost)</h3>

<p>Untuk mengizinkan dan menghapus akses ke dalam sharing folder publik, buat pengguna baru bernama samba_test_user, pengguna ini akan diberikan izin terlebih dahulu untuk membaca folder publik, lalu akses untuk membaca dan menulis folder publik.</p>

<p>Proses yang sama yang ditunjukkan di sini dapat digunakan untuk memberikan akses ke share folder publik Anda kepada pengguna lain dari komputer Anda.</p>

<p>Samba_test_user akan dibuat sebagai akun pengguna yang sudah di lock, tidak mengizinkan login ke komputer.</p>

<p>Create ‘samba_test_user’, and lock the account.</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># useradd samba_test_user
# passwd --lock samba_test_user
</code></pre></div>  </div>
</blockquote>

<p>Set a Samba Password for this Test User (such as ‘test’):</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># smbpasswd -a samba_test_user
</code></pre></div>  </div>
</blockquote>

<h4 id="test-read-only-access-to-the-public-share">Test Read Only access to the Public Share:</h4>

<p>Add samba_test_user to the public_readonly group:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># gpasswd --add samba_test_user public_readonly
</code></pre></div>  </div>
</blockquote>

<p>Login to the local Samba Service (public folder):</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ smbclient --user=samba_test_user //localhost/public
</code></pre></div>  </div>
</blockquote>

<p>First, the ls command should succeed,
Second, the mkdir command should not work,
and finally, exit:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: \&gt; ls
smb: \&gt; mkdir error
smb: \&gt; mkdir error
</code></pre></div>  </div>
</blockquote>

<p>Remove samba_test_user from the public_readonly group:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpasswd --delete samba_test_user public_readonly
</code></pre></div>  </div>
</blockquote>

<h4 id="test-read-and-write-access-to-the-public-share">Test Read and Write access to the Public Share:</h4>

<p>Add samba_test_user to the public_readwrite group:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># gpasswd --add samba_test_user public_readwrite
</code></pre></div>  </div>
</blockquote>

<p>Login to the local Samba Service (public folder):</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ smbclient --user=samba_test_user //localhost/public
</code></pre></div>  </div>
</blockquote>

<p>First, the ls command should succeed,
Second, the mkdir command should work,
Third, the rmdir command should work,
and finally, exit:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: \&gt; ls
smb: \&gt; mkdir success
smb: \&gt; rmdir success
smb: \&gt; exit
</code></pre></div>  </div>
</blockquote>

<p>Remove samba_test_user from the public_readwrite group:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># gpasswd --delete samba_test_user public_readwrite
</code></pre></div>  </div>
</blockquote>

<p>Setelah pengujian selesai, untuk keamanan, nonaktifkan kemampuan samba_test_user untuk login melalui samba.</p>

<p>Disable samba_test_user login via samba:</p>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># smbpasswd -d samba_test_user
</code></pre></div>  </div>
</blockquote>

<h2 id="home-folder-sharing">Home Folder Sharing</h2>

<p>Di bagian terakhir panduan ini; Samba akan dikonfigurasi untuk berbagi User Home Folder.</p>

<p>Misalnya: Jika bob pengguna telah terdaftar pada smbpasswd, direktori home bob /home/bob, akan menjadi share //server-name/bob.</p>

<p>Share ini hanya akan tersedia untuk bob, dan tidak di pengguna lain.</p>

<p><code class="language-plaintext highlighter-rouge">source: http://fedoramagazine.org/fedora-32-simple-local-file-sharing-with-samba/</code></p>

:ET